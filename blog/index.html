<!DOCTYPE html>
<html lang="en" data-theme="">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<script type="text/javascript">/*<![CDATA[*/window.__chunkMapping={"main":["/main.9b0aefc2eff372e483a4.css","/main.ce136d421303be087674.js"],"component---site-src-pages-index-jsc-4-f-f99":["/component---site-src-pages-index-jsc-4-f-f99.358a4bd817d0c946a3fc.css","/component---site-src-pages-index-jsc-4-f-f99.2a91dd86816a2e078b39.js"],"component---theme-blog-post-pageccc-cab":["/component---theme-blog-post-pageccc-cab.c0f42af064ae6a8754fe.css","/component---theme-blog-post-pageccc-cab.36447cbeaf4672bdbb0a.js"],"content---blog-2018-10-22-hello-worldcbb-e2a":["/content---blog-2018-10-22-hello-worldcbb-e2a.9c2e83dca080d3244ada.js"],"metadata---blog-2018-10-22-hello-world-75-b-360":["/metadata---blog-2018-10-22-hello-world-75-b-360.cf00bf416a5b3b17ba73.js"],"nextItem---blog-2018-10-22-hello-world-473-b89":["/nextItem---blog-2018-10-22-hello-world-473-b89.d99cc84a55b8ebae18d6.js"],"content---blog-2018-01-14-rust-2018-a-neon-wish-listaa-8-a9b":["/content---blog-2018-01-14-rust-2018-a-neon-wish-listaa-8-a9b.d4e40b9296f12a30ba45.js"],"nextItem---blog-2018-01-14-rust-2018-a-neon-wish-listcea-8d0":["/nextItem---blog-2018-01-14-rust-2018-a-neon-wish-listcea-8d0.e89b81c942fed6090d10.js"],"content---blog-2017-09-25-neon-wants-your-help-25-f-089":["/content---blog-2017-09-25-neon-wants-your-help-25-f-089.77021380abfc9e971d4a.js"],"nextItem---blog-2017-09-25-neon-wants-your-helpbc-0-72a":["/nextItem---blog-2017-09-25-neon-wants-your-helpbc-0-72a.38139701f750bf113b09.js"],"content---blog-2016-04-01-native-js-classes-in-neon-29-a-6e2":["/content---blog-2016-04-01-native-js-classes-in-neon-29-a-6e2.5fb58c46b15092b83e94.js"],"nextItem---blog-2016-04-01-native-js-classes-in-neon-81-a-35c":["/nextItem---blog-2016-04-01-native-js-classes-in-neon-81-a-35c.e8b0ad36e6019cc5a771.js"],"content---blog-2015-12-23-neon-node-rustb-3-e-e3c":["/content---blog-2015-12-23-neon-node-rustb-3-e-e3c.92f332e2503dff40af3d.js"],"component---theme-blog-list-pagea-6-a-7ba":["/component---theme-blog-list-pagea-6-a-7ba.c0f42af064ae6a8754fe.css","/component---theme-blog-list-pagea-6-a-7ba.73e7f10320fd40850a08.js"],"content---blogcee-0c9":["/content---blogcee-0c9.35a29afc27cd16810de8.js"],"content---blog-191-793":["/content---blog-191-793.474fac1b2a9442c6f41d.js"],"content---blogab-1-45e":["/content---blogab-1-45e.3b4250fe9ebdc796d69f.js"],"content---blog-89-e-b53":["/content---blog-89-e-b53.f3496b554278894dbcb3.js"],"content---blogccb-196":["/content---blogccb-196.9e553299d1626cc06c1f.js"],"metadata---blog-1-a-9-d63":["/metadata---blog-1-a-9-d63.696b05f19503cdb900a9.js"],"component---theme-doc-page-1-be-9be":["/component---theme-doc-page-1-be-9be.a8f048a05ef18dca2170.css","/component---theme-doc-page-1-be-9be.6cb677395a301dd38f39.js"],"docsMetadata---docs-1-da-721":["/docsMetadata---docs-1-da-721.d68ec240f1ded33b1703.js"],"component---theme-doc-item-178-a40":["/component---theme-doc-item-178-a40.c470f1b94d3c35d1f80c.css","/component---theme-doc-item-178-a40.dcfe4d24a6c17fe56a8e.js"],"content---docs-classes-6-ab-bc0":["/content---docs-classes-6-ab-bc0.e97724abcab7f5e0f973.js"],"metadata---docs-classesb-07-47b":["/metadata---docs-classesb-07-47b.6c736a451e9b8a4659c7.js"],"content---docs-arrays-9-fd-c60":["/content---docs-arrays-9-fd-c60.d30e218bb32b658d1a14.js"],"metadata---docs-arraysb-79-a81":["/metadata---docs-arraysb-79-a81.dae7611ea3f45f79ec5f.js"],"content---docs-asyncfb-3-195":["/content---docs-asyncfb-3-195.1e4f9d9fce70d3e72822.js"],"metadata---docs-async-86-c-1cb":["/metadata---docs-async-86-c-1cb.a65961fe48cd126dfb71.js"],"content---docs-electron-appse-84-526":["/content---docs-electron-appse-84-526.e320a6ed69c2a41c286b.js"],"metadata---docs-electron-apps-0-a-0-79d":["/metadata---docs-electron-apps-0-a-0-79d.96091e219ebaf6ac16fb.js"],"content---docs-cli-1-a-2-6cb":["/content---docs-cli-1-a-2-6cb.e94cdc72798fd33b5de1.js"],"metadata---docs-cli-7-a-6-ef7":["/metadata---docs-cli-7-a-6-ef7.c408f1608730c2e9216c.js"],"content---docs-errors-8-a-2-a16":["/content---docs-errors-8-a-2-a16.12605c450703a8b6a2c8.js"],"metadata---docs-errorsc-0-a-e30":["/metadata---docs-errorsc-0-a-e30.b6e4b47f7d696e783d0c.js"],"content---docs-example-projectsb-58-8db":["/content---docs-example-projectsb-58-8db.bc2ed6fe936cd03acdcc.js"],"metadata---docs-example-projectse-85-8bd":["/metadata---docs-example-projectse-85-8bd.1aed2d1018eeb656b64b.js"],"content---docs-functionsd-47-b12":["/content---docs-functionsd-47-b12.825c08790d5c907de1c2.js"],"metadata---docs-functions-725-8e7":["/metadata---docs-functions-725-8e7.443068cd691c864e31f1.js"],"content---docs-getting-startedd-58-f94":["/content---docs-getting-startedd-58-f94.d93c973f3a74b9cf8a8b.js"],"metadata---docs-getting-started-57-d-ca5":["/metadata---docs-getting-started-57-d-ca5.9fb2dc6a6354cbe144b3.js"],"content---docs-guidesd-7-b-d2a":["/content---docs-guidesd-7-b-d2a.3dfa0fb062962a42be41.js"],"metadata---docs-guides-390-64f":["/metadata---docs-guides-390-64f.4e2cfd551a2c40db4fd8.js"],"content---docs-intro-0-e-3-be1":["/content---docs-intro-0-e-3-be1.b1a242e06b95809eedbf.js"],"metadata---docs-intro-368-f5c":["/metadata---docs-intro-368-f5c.339f392dcb2bae9010b9.js"],"content---docs-modules-23-d-147":["/content---docs-modules-23-d-147.d30eeae6bf40eefc0142.js"],"metadata---docs-modules-572-72c":["/metadata---docs-modules-572-72c.107aa54049ea7892401b.js"],"content---docs-hello-world-900-633":["/content---docs-hello-world-900-633.71c85551fa776908b910.js"],"metadata---docs-hello-world-5-fa-289":["/metadata---docs-hello-world-5-fa-289.cb3986e83797f3498581.js"],"content---docs-learning-resources-4-bb-6d1":["/content---docs-learning-resources-4-bb-6d1.21c5d52d965b76ced6d2.js"],"metadata---docs-learning-resources-8-f-4-098":["/metadata---docs-learning-resources-8-f-4-098.8c5974a7dfdb730d48ee.js"],"content---docs-json-3-ad-4fa":["/content---docs-json-3-ad-4fa.dc25962d98070bdeab6a.js"],"metadata---docs-json-9-f-3-aa7":["/metadata---docs-json-9-f-3-aa7.6629bcfb52562e966de2.js"],"content---docs-primitivesf-05-214":["/content---docs-primitivesf-05-214.bbaf552a7566ee42a57c.js"],"metadata---docs-primitivesd-85-9c2":["/metadata---docs-primitivesd-85-9c2.88516f2adfaf46b2ecf0.js"],"content---docs-parallelism-003-d1d":["/content---docs-parallelism-003-d1d.5fdd457a34fd47536330.js"],"metadata---docs-parallelismc-81-633":["/metadata---docs-parallelismc-81-633.34928c00cdaff7659b77.js"],"content---docs-publishing-2-d-2-25a":["/content---docs-publishing-2-d-2-25a.046de2bde92ef2af4b11.js"],"metadata---docs-publishinge-62-bbf":["/metadata---docs-publishinge-62-bbf.a21a2352962284f3b2a6.js"],"content---docs-arguments-65-b-849":["/content---docs-arguments-65-b-849.27a11c545b6f77efe63b.js"],"metadata---docs-arguments-6-fe-fea":["/metadata---docs-arguments-6-fe-fea.6f6fc2e73206d1707220.js"],"content---docs-objectsb-51-593":["/content---docs-objectsb-51-593.a3c7b0eb268ec18fb7fd.js"],"metadata---docs-objects-066-5ec":["/metadata---docs-objects-066-5ec.683c31640e7d5d5208b7.js"],"content---docs-sdl-2-guide-658-6b7":["/content---docs-sdl-2-guide-658-6b7.b65129e9b6a7bd910e14.js"],"metadata---docs-sdl-2-guide-958-5dd":["/metadata---docs-sdl-2-guide-958-5dd.c173b42240542fc11174.js"],"content---docs-word-counting-99-f-4ea":["/content---docs-word-counting-99-f-4ea.0edd4083dd0955dfd419.js"],"metadata---docs-word-countingb-5-c-379":["/metadata---docs-word-countingb-5-c-379.219638f42341c7ba7e07.js"],"content---docs-type-checking-02-d-2e2":["/content---docs-type-checking-02-d-2e2.5cff8f9e050f73f1c40a.js"],"metadata---docs-type-checking-45-c-033":["/metadata---docs-type-checking-45-c-033.0a44400b6a3396a8465b.js"],"content---docs-roadmap-0-df-a69":["/content---docs-roadmap-0-df-a69.f24a83550845276e512f.js"],"metadata---docs-roadmap-5-f-6-348":["/metadata---docs-roadmap-5-f-6-348.4069d1614382e4654244.js"],"content---docs-tooling-12-e-380":["/content---docs-tooling-12-e-380.dbdbc7b7f67d5a1845e6.js"],"metadata---docs-tooling-6-ec-0db":["/metadata---docs-tooling-6-ec-0db.d26b077698a34d0feade.js"]};/*]]>*/</script>

<title data-react-helmet="true">Blog</title>

<meta data-react-helmet="true" charset="utf-8"/><meta data-react-helmet="true" http-equiv="x-ua-compatible" content="ie=edge"/><meta data-react-helmet="true" name="viewport" content="width=device-width"/><meta data-react-helmet="true" property="og:title" content="Blog"/><meta data-react-helmet="true" name="description" content="Blog"/><meta data-react-helmet="true" property="og:description" content="Blog"/><meta data-react-helmet="true" name="twitter:card" content="summary"/>

<link data-react-helmet="true" rel="shortcut icon" href="/logo/letter-logo.png"/>


<link rel="stylesheet" type="text/css" href="/main.9b0aefc2eff372e483a4.css" />

<link rel="stylesheet" type="text/css" href="/0.a5d98dcdf0bbe087ed21.css" />

<link rel="stylesheet" type="text/css" href="/1.27ddfe0828c980c86fac.css" />

<link rel="stylesheet" type="text/css" href="/component---theme-blog-list-pagea-6-a-7ba.c0f42af064ae6a8754fe.css" />

</head>
<body >
<div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a aria-current="page" class="navbar__brand active" href="/"><img class="navbar__logo" src="/logo/letter-logo.png" alt="Neon Logo"/><strong class="">Neon</strong></a><a class="navbar__item navbar__link" label="Docs" href="/docs/intro">Docs</a><a class="navbar__item navbar__link" href="https://github.com/neon-bindings/examples#table-of-contents" label="Examples" target="_blank" rel="noopener noreferrer">Examples</a><a class="navbar__item navbar__link" href="/api/neon/" label="API" target="_blank" rel="noopener noreferrer">API</a><a class="navbar__item navbar__link" label="Resources" href="/docs/learning-resources">Resources</a><a class="navbar__item navbar__link" label="Roadmap" href="/docs/roadmap">Roadmap</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" label="Blog" href="/blog">Blog</a><a class="navbar__item navbar__link" href="https://github.com/neon-bindings/neon" label="GitHub" target="_blank" rel="noopener noreferrer">GitHub</a></div><div class="navbar__items navbar__items--right"><div class="react-toggle displayOnlyInLargeViewport_3J-v"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_Q9cy moon_1D9f"></span></div><div class="react-toggle-track-x"><span class="toggle_Q9cy sun_1k0k"></span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"/></div><div class="navbar__search"><span role="button" class="search-icon" tabindex="0"></span><input type="search" id="search_input_react" placeholder="Search" aria-label="Search" class="search-bar"/></div></div></div><div role="presentation" class="navbar__sidebar__backdrop"></div><div class="navbar__sidebar"><div class="navbar__sidebar__brand"><a aria-current="page" class="navbar__brand active" href="/"><img class="navbar__logo" src="/logo/letter-logo.png" alt="Neon Logo"/><strong>Neon</strong></a></div><div class="navbar__sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" label="Docs" href="/docs/intro">Docs</a></li><li class="menu__list-item"><a class="menu__link" href="https://github.com/neon-bindings/examples#table-of-contents" label="Examples" target="_blank" rel="noopener noreferrer">Examples</a></li><li class="menu__list-item"><a class="menu__link" href="/api/neon/" label="API" target="_blank" rel="noopener noreferrer">API</a></li><li class="menu__list-item"><a class="menu__link" label="Resources" href="/docs/learning-resources">Resources</a></li><li class="menu__list-item"><a class="menu__link" label="Roadmap" href="/docs/roadmap">Roadmap</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" label="Blog" href="/blog">Blog</a></li><li class="menu__list-item"><a class="menu__link" href="https://github.com/neon-bindings/neon" label="GitHub" target="_blank" rel="noopener noreferrer">GitHub</a></li></ul></div></div></div></nav><div class="container margin-vert--xl"><div class="row"><div class="col col--8 col--offset-2"><div class="margin-bottom--xl"><div><header><h1 class="margin-bottom--sm blogPostTitle_3vXB"><a href="/blog/2018/10/22/hello-world">New Docs and Website! 🎉🎉🎉</a></h1><div class="margin-bottom--sm"><small>October<!-- --> <!-- -->22<!-- -->, <!-- -->2018</small></div><div class="avatar margin-bottom--md"><div class="avatar__intro"><h4 class="avatar__name"><a target="_blank" rel="noreferrer noopener">Amila Welihinda</a></h4><small class="avatar__subtitle"></small></div></div></header><article class="markdown"><p>This is the first post from the rewritten website for neon. This site is based on a static site generator, called <a href="https://docusaurus.io/">docusarus</a>, and it is specifically for documentation. Here are some of the goals of this new website some of the benefits that come with choosing this stack:</p><p>The goal of this new website is to:</p><ul><li>Replace the existing website, which is based on jekyll</li><li>Use newer web stack and infra: React, docusarus, babel, webpack, etc</li><li>Easy to maintain docs (<a href="https://docusaurus.io/">Docusarus</a> makes this easy)</li><li>Built-in search functionality with algolia (<a href="https://docusaurus.io/">Docusarus</a> makes this easy)</li><li>Ready for Translations (<a href="https://docusaurus.io/">Docusarus</a> makes this easy)</li></ul></article><div class="row margin-vert--lg"><div class="col"></div><div class="col text--right"><a href="/blog/2018/10/22/hello-world"><strong>Read More</strong></a></div></div></div></div><div class="margin-bottom--xl"><div><header><h1 class="margin-bottom--sm blogPostTitle_3vXB"><a href="/blog/2018/01/14/rust-2018-a-neon-wish-list">#Rust2018: A Neon Wish List</a></h1><div class="margin-bottom--sm"><small>January<!-- --> <!-- -->14<!-- -->, <!-- -->2018</small></div><div class="avatar margin-bottom--md"><div class="avatar__intro"><h4 class="avatar__name"><a target="_blank" rel="noreferrer noopener">Dave Herman</a></h4><small class="avatar__subtitle"></small></div></div></header><article class="markdown"><p>⚠️ This article contains references to an outdated version of neon ⚠️</p><p>While I&#x27;ve been thoroughly enjoying the Rust community&#x27;s spirited <a href="https://blog.rust-lang.org/2018/01/03/new-years-rust-a-call-for-community-blogposts.html">#Rust2018 blog-fest</a>, I wasn&#x27;t really thinking of participating myself until <a href="http://jvns.ca">Julia Evans</a> pointed out <a href="https://twitter.com/b0rk/status/952370352759418880">the leadership wants to hear from everyone</a>---even if I might not have anything especially new to add. So here&#x27;s my little wish list for Rust in 2018.</p><p>Since I&#x27;m not in Rust&#x27;s leadership, I don&#x27;t have to worry about synthesizing some grand narrative for the whole of Rust. So I&#x27;ll just focus on a few things that would be personally useful to me. In particular, I&#x27;ll stick to topics that would be helpful for my <a href="https://www.neon-bindings.com">Neon</a> project, a set of bindings for writing native Node extension modules in Rust.</p><h1><a aria-hidden="true" class="anchor" id="stabilize-impl-trait"></a><a aria-hidden="true" class="hash-link" href="#stabilize-impl-trait">#</a>Stabilize <code>impl trait</code></h1><p>The most challenging part of keeping Neon&#x27;s design manageable is the annotation burden. Neon provides a safe API for managing handles into Node&#x27;s JavaScript garbage collector, and to do this, it requires passing around a &quot;handle scope&quot; parameter everywhere, which tracks the lifetimes of handles. There are a few flavors of handle scopes, which means helper functions in Neon projects often end up with some pretty hairy signatures:</p><pre class="mdxCodeBlock_ziUc"><div class="codeBlockWrapper_3ZcX"><pre class="prism-code language-rust codeBlock_1wn8" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">fn</span><span class="token plain"> get_foo_bar</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token lifetime-annotation symbol">&#x27;a,</span><span class="token plain"> S</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> Scope</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token lifetime-annotation symbol">&#x27;a</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">scope</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token keyword" style="font-style:italic">mut</span><span class="token plain"> S</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> obj</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> Handle</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token lifetime-annotation symbol">&#x27;a,</span><span class="token plain"> JsObject</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-&gt;</span><span class="token plain"> JsResult</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token lifetime-annotation symbol">&#x27;a,</span><span class="token plain"> JsValue</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// extract the `obj.foo` property and check that it&#x27;s an object</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">let</span><span class="token plain"> foo </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> obj</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">get</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">scope</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;foo&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token operator" style="color:rgb(137, 221, 255)">?</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">check</span><span class="token punctuation" style="color:rgb(199, 146, 234)">::</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">JsObject</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token operator" style="color:rgb(137, 221, 255)">?</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// extract the `obj.foo.bar` property</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">let</span><span class="token plain"> bar </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">get</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">scope</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;bar&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token operator" style="color:rgb(137, 221, 255)">?</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">Ok</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">bar</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1PCb">Copy</button></div></pre><p>I would love for Neon users to be able to combine lifetime elision and the <a href="https://github.com/rust-lang/rust/issues/34511"><code>impl trait</code></a> shorthand syntax to write something like:</p><pre class="mdxCodeBlock_ziUc"><div class="codeBlockWrapper_3ZcX"><pre class="prism-code language-rust codeBlock_1wn8" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">fn</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">get_foo_bar</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">scope</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token keyword" style="font-style:italic">mut</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">impl</span><span class="token plain"> Scope</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> obj</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> Handle</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">JsObject</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-&gt;</span><span class="token plain"> JsResult</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">JsValue</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// ...</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1PCb">Copy</button></div></pre><p>(With an upcoming <a href="https://github.com/dherman/rfcs-1/blob/vm-two-point-oh/text/vm-2.0.md">cleanup of the core Neon API</a>, the details of this would change a bit, but <code>impl trait</code> would be just as appealing.)</p><h1><a aria-hidden="true" class="anchor" id="syntactic-abstraction-for-error-propagation"></a><a aria-hidden="true" class="hash-link" href="#syntactic-abstraction-for-error-propagation">#</a>Syntactic abstraction for error propagation</h1><p>I adore the <code>?</code> syntax, but it&#x27;s not enough! Expressions like <code>Ok(bar)</code> in the above example are an indication that we don&#x27;t have a complete abstraction layer in the syntax for error propagation. I find it particularly galling when I have to see <code>Ok(())</code>. It&#x27;s dipping down into an unnecessary abstraction layer, distracting the core logic of the function with mechanical details of the representation of Rust&#x27;s control flow protocols.</p><p>I&#x27;m excited about the discussions around <a href="https://internals.rust-lang.org/t/pre-rfc-catching-functions/6505">&quot;catching functions&quot;</a>. I think we can get to a sweet spot where we have an abstraction layer in the syntax that never exposes the <code>Result</code> type for error handling, while still explicitly annotating every point that may throw (thanks to <code>?</code> syntax, and by contrast to exceptions). The above examples might look something like:</p><pre class="mdxCodeBlock_ziUc"><div class="codeBlockWrapper_3ZcX"><pre class="prism-code language-rust codeBlock_1wn8" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">fn</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">get_foo_bar</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">scope</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token keyword" style="font-style:italic">mut</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">impl</span><span class="token plain"> Scope</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> obj</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> Handle</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">JsObject</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-&gt;</span><span class="token plain"> Handle</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">JsValue</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> catch JsException </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">let</span><span class="token plain"> foo </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> obj</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">get</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">scope</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;foo&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token operator" style="color:rgb(137, 221, 255)">?</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">check</span><span class="token punctuation" style="color:rgb(199, 146, 234)">::</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">JsObject</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token operator" style="color:rgb(137, 221, 255)">?</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">let</span><span class="token plain"> bar </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">get</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">scope</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;bar&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token operator" style="color:rgb(137, 221, 255)">?</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> bar</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1PCb">Copy</button></div></pre><h1><a aria-hidden="true" class="anchor" id="make-cargo-more-extendable"></a><a aria-hidden="true" class="hash-link" href="#make-cargo-more-extendable">#</a>Make cargo more extendable</h1><p>Like <code>xargo</code> and <code>wargo</code>, Neon comes with a command-line tool that wraps cargo&#x27;s behavior in order to abstract away a bunch of build configuration details. I&#x27;m proud of this abstraction, because it makes building native modules in Node far easier than they are with C++. But I would much rather Neon programmers could use cargo directly, calling all their usual familiar commands like <code>cargo build</code> and <code>cargo run</code>.</p><p>To support this, Neon will need a handful of extension points that don&#x27;t exist today:</p><ul><li>The ability to extend the memoization logic with extra environmental information (e.g. which version of Node is being built for and the values of some Node-specific environment variables).</li><li>Post-build hooks, so I can generate the final DLL and put it in the right directory.</li><li>The ability to add default build flags (for example, on macOS, <code>neon build</code> actually calls <code>cargo rustc</code> with some extra low-level linking flags).</li><li>Project templates for <code>cargo new</code>.</li></ul><p>Being able to write</p><pre class="mdxCodeBlock_ziUc"><div class="codeBlockWrapper_3ZcX"><pre class="prism-code language-shell codeBlock_1wn8" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ cargo new --template</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">neon my-first-neon-project</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">cd</span><span class="token plain"> my-first-neon-project</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ cargo run</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1PCb">Copy</button></div></pre><p>would be so amazing.</p><h1><a aria-hidden="true" class="anchor" id="neon-is-about-welcoming-js-programmers"></a><a aria-hidden="true" class="hash-link" href="#neon-is-about-welcoming-js-programmers">#</a>Neon is about welcoming JS programmers</h1><p>I promised no narrative, but there is a common thread here. I started the Neon project because I thought it would make a great bridge between the JavaScript and Rust communities. All of the topics in this post are about facilitating that connection:</p><ul><li>Neon forces JS programmers to get more explicit about working with the garbage collector than they normally have to, so making that as lightweight as possible makes falling into native code less of a steep cliff.</li><li>JS is a language with exceptions, so making the protocol for emulating exceptions in Rust as ergonomic as possible will make Rust a better environment for JS programmers.</li><li>And just as Node projects have a workflow oriented around <code>npm</code>, giving Neon projects a standard <code>cargo</code>-based workflow will feel familiar and pleasant to Node programmers.</li></ul><p>My dream is that Neon can serve as a gateway welcoming JS programmers into Rust and systems programming for years to come. The more we smoothe the path between them, the more people we invite into our community.</p></article><div class="row margin-vert--lg"><div class="col"></div><div class="col text--right"><a href="/blog/2018/01/14/rust-2018-a-neon-wish-list"><strong>Read More</strong></a></div></div></div></div><div class="margin-bottom--xl"><div><header><h1 class="margin-bottom--sm blogPostTitle_3vXB"><a href="/blog/2017/09/25/neon-wants-your-help">Neon Wants Your Help!</a></h1><div class="margin-bottom--sm"><small>September<!-- --> <!-- -->25<!-- -->, <!-- -->2017</small></div><div class="avatar margin-bottom--md"><div class="avatar__intro"><h4 class="avatar__name"><a target="_blank" rel="noreferrer noopener">Dave Herman</a></h4><small class="avatar__subtitle"></small></div></div></header><article class="markdown"><p>⚠️ This article contains references to an outdated version of neon ⚠️</p><p>My history with Rust goes back a long way. But it was when I really started to understand its <a href="https://www.youtube.com/watch?v=ySW6Yk_DerY">enabling potential</a>, its capacity to empower whole groups of people to do things they couldn&#x27;t do before, that I just had to find a more direct way to get involved with making that promise a reality.</p><p>I decided that the best way I could help widen the on-ramp to Rust was to create <a href="https://www.neon-bindings.com">Neon</a>: a library for conveniently implementing native Node.js modules with Rust instead of C/C++. With Neon, JavaScript programmers can get access to all the power that Rust offers: high-performance native code, convenient multithreading, freedom from memory faults and data races, and access to native libraries and the <a href="https://crates.io">Cargo</a> ecosystem. And they can do this without throwing away their working apps or existing expertise. In short, my goal with Neon is to make it easy for JavaScript programmers to &quot;dip their toe&quot; into Rust without diving straight into the deep end.</p><img class="right" style="width:200px;height:150px" src="/assets/help-wanted.jpg"/> We&#x27;ve made some great progress recently, with some cool new features including [Electron support](https://guides.neon-bindings.com/electron-apps/) and a new [Task API](https://neon-bindings.com/api/neon/task/) for asynchronously spawning Rust computations to run in a background thread. **But Neon is still a young project, and could use your help to take it to the next level!** Neon is still primarily built by me and a small set of contributors, so **I&#x27;m looking for contributors with a wide range of skills and interests** who can join us to take Neon to the next level and eventually **grow into a project leadership team.** I think we&#x27;re onto something exciting here: a chance to build bridges between the JavaScript and Rust worlds and to create opportunities for aspiring new systems programmers. And I hope you&#x27;ll consider being a part of it!<h2><a aria-hidden="true" class="anchor" id="and-i-mean-a-wide-range"></a><a aria-hidden="true" class="hash-link" href="#and-i-mean-a-wide-range">#</a>...And I Mean a Wide Range</h2><p>My dream is to make Neon:</p><ul><li><strong>Easy to learn:</strong> The default abstraction layer should be intuitive enough that a newcomer&#x27;s first experience coming from JavaScript should be approachable, and there should be documentation and learning materials to smoothe the on-boarding experience.</li><li><strong>Rock-solid:</strong> Users should feel confident that refactoring their code in Rust should be no more likely to crash their Node server than vanilla JavaScript.</li><li><strong>Fully-featured:</strong> The Neon API should be able to express everything you could do in JavaScript itself.</li><li><strong>Stable:</strong> Once we start approaching 1.0, Neon should get on a regular release cycle, with strong commitment to semantic versioning and backwards compatibility.</li></ul><p>Just to give you a sense of the many varied kinds of contributions we could use, here&#x27;s a taste:</p><p><strong>Project management.</strong> We should keep on top of issues and PRs. I would love to set up a regular meeting with anyone who&#x27;s willing to help out with this! I could also use help setting up a simple RFC process similar to <a href="https://github.com/rust-lang/rfcs">Rust RFCs</a>, especially for having community discussions around API and workflow design.</p><p><strong>Technical writing.</strong> The <a href="https://github.com/neon-bindings/guides">guides</a> are shaping up, but they&#x27;re incomplete and one of the most important tools for on-boarding new users. The <a href="https://neon-bindings.com/api">API docs</a> are pretty rudimentary and would benefit from many more examples---we should strive for a high-quality, illustrative example for every single API.</p><p><strong>Testing.</strong> The <a href="https://github.com/neon-bindings/neon/tree/master/test">test suite</a> has a decent structure but is not at all complete. We should aim for complete test coverage of the API!</p><p><strong>Teaching.</strong> I would love to get some good thinking into how to teach Neon to various audiences, especially people who are new to Rust and systems programming. We could use this to drive the way we structure the guides, tutorial videos, etc.</p><p><strong>Windows development.</strong> My primary development machine is Windows these days, but I&#x27;m not an expert. I recently <a href="https://github.com/neon-bindings/neon/issues/248">broke our Appveyor builds</a> just to prove it! 😝 We&#x27;ve also seen some intermittent hangs in Appveyor builds and I&#x27;d love a Windows expert to <a href="https://github.com/neon-bindings/neon/issues/250">do some investigating</a>!</p><p><strong>Web development.</strong> The Neon web site is currently a static page. It certainly would be fun to set it up as a Node page using Neon itself! One of the nice dynamic things we could do would be to create a roadmap page like <a href="http://usehelix.com/roadmap">the one Helix has</a>, with automatic tracking of milestone progress using GitHub APIs. We should also set up a Neon project blog with Jekyll and style it consistently with the rest of <a href="https://www.neon-bindings.com">neon-bindings.com</a>.</p><p><strong>Ops and automation.</strong> I&#x27;ve started an <a href="https://github.com/neon-bindings/neon/issues?q=is%3Aissue+is%3Aopen+label%3Aautomation">automation label</a> in the issues. A fantastic contribution would be an automated <a href="https://github.com/neon-bindings/neon/issues/42">publication script</a> to make releases one-touch. (This is realistically achievable now thanks to some project reorganization.)</p><p><strong>Node plugins.</strong> We should explore the possibility of supporting using the new <a href="https://nodejs.org/api/n-api.html">N-API</a> as an alternative backend for the implementation. We wouldn&#x27;t be able to move to this as the default backend right away, but it could pave the way for supporting <a href="https://github.com/nodejs/node-chakracore">Node on ChakraCore</a>, and eventually might replace the current backend entirely.</p><p><strong>API design.</strong> There are lots of things you can do in JavaScript that you still can&#x27;t do in Neon, so there&#x27;s plenty of missing APIs to finish. And it&#x27;s not too late to make incompatible changes to the API that&#x27;s there currently. For example, I&#x27;d be especially interested in ideas about making the <a href="https://neon-bindings.com/api/neon/scope/trait.scope"><code>Scope</code></a> API less awkward, if possible.</p><p><strong>Cargo extensions.</strong> So far, the <a href="https://www.npmjs.com/package/neon-cli">neon-cli</a> workflow has been reasonably successful at abstracting away the painful configuration details required to build native Node modules correctly. But the <em>ideal</em> situation would be to allow programmers to just use <code>cargo build</code>, <code>cargo run</code>, and the like to build their Neon crates like any other Rust project. The recent discussions around <a href="https://github.com/rust-lang/rfcs/pull/2136">making Cargo extendable</a> open up some exciting possibilities to push in this direction. One of the ways you can indirectly help with Neon is to help that effort.</p><p><strong>Macrology.</strong> One of the big, exciting projects we have left is to flesh out the <!-- -->[high-level macro for defining JavaScript classes]<!-- -->({{ site.baseurl }}{% post_url 2016-04-01-native-js-classes-in-neon %}) (and another for defining standalone functions) so users can use simple type annotations to automate conversions between JavaScript and Rust types. We should take inspiration from the design of our sibling project, <a href="http://usehelix.com">Helix</a>!</p><p><strong>Systems programming.</strong> One of the biggest challenges we have to tackle is making the process of shipping Neon libraries practical, especially for shipping prebuilt binaries. One technique we can explore is to create an ABI-stable middle layer so that Neon binaries don&#x27;t need to be rebuilt for different versions of Node.</p><p><strong>Threading architectures.</strong> Currently, Neon supports a couple of forms of threading: pausing the JavaScript VM to synchronously run a parallelized Rust computation (via the <a href="https://neon-bindings.com/api/neon/vm/trait.lock"><code>Lock</code></a> API), and running a background <a href="https://neon-bindings.com/api/neon/task/trait.task"><code>Task</code></a> as part of the <a href="http://docs.libuv.org/en/v1.x/threadpool.html">libuv thread pool</a>. There&#x27;s more we can do both on the computation side (for example, supporting <a href="https://github.com/neon-bindings/neon/issues/228">attaching to different threads than libuv&#x27;s pool</a>) and the data side (for example, supporting <a href="https://v8docs.nodesource.com/node-8.0/d5/d6e/classv8_1_1_array_buffer.html#a9291f6ac203b9ceae83f7f17d39ecb59"><code>ArrayBuffer</code> transfer</a>).</p><h2><a aria-hidden="true" class="anchor" id="getting-involved"></a><a aria-hidden="true" class="hash-link" href="#getting-involved">#</a>Getting Involved</h2><p>Does any of these sound like something you&#x27;d be interested in? Or maybe you have other ideas! If you want to help, come talk to me (<strong>@dherman</strong>) in the <a href="https://rust-bindings.slack.com/messages/neon"><code>#neon</code> community Slack channel</a> (make sure to get an <a href="https://rust-bindings-slackin.herokuapp.com/">automatic invite</a> first).</p><h2><a aria-hidden="true" class="anchor" id="a-note-about-community"></a><a aria-hidden="true" class="hash-link" href="#a-note-about-community">#</a>A Note About Community</h2><p>As the original creator of this project, I&#x27;m responsible not only for the software but for the community I foster. I <em>deeply love</em> this part of open source, and I don&#x27;t take the responsibility lightly.</p><p>Neon has a ton of cool tech inside of it, and if that&#x27;s the only aspect you&#x27;re interested in, that&#x27;s totally OK. Not everyone needs to be passionate about community-building. Still, not unlike Rust, this whole project&#x27;s purpose is to <strong>widen the circle of tech and empower new systems programmers.</strong> So I ask of everyone who participates in the Neon project to strive to act in ways that will encourage and motivate as many people as possible to participate.</p><p>Concretely, Neon uses the <a href="https://www.contributor-covenant.org/">Contributor Covenant</a> to frame the expectations and standards of how we treat people in our community. Behind the policies is a simple goal: to <strong>make our community a place that welcomes, trusts, supports, and empowers one another.</strong></p><p>If that sounds good to you, wanna come join us?</p></article><div class="row margin-vert--lg"><div class="col"></div><div class="col text--right"><a href="/blog/2017/09/25/neon-wants-your-help"><strong>Read More</strong></a></div></div></div></div><div class="margin-bottom--xl"><div><header><h1 class="margin-bottom--sm blogPostTitle_3vXB"><a href="/blog/2016/04/01/native-js-classes-in-neon">Native JS Classes in Neon</a></h1><div class="margin-bottom--sm"><small>April<!-- --> <!-- -->1<!-- -->, <!-- -->2016</small></div><div class="avatar margin-bottom--md"><div class="avatar__intro"><h4 class="avatar__name"><a target="_blank" rel="noreferrer noopener">Dave Herman</a></h4><small class="avatar__subtitle"></small></div></div></header><article class="markdown"><p>⚠️ This article contains references to an outdated version of neon ⚠️</p><p>Last weekend I <a href="https://github.com/rustbridge/neon/pull/58">landed a PR</a> that adds support for defining custom native classes in <!-- -->[Neon]<!-- -->({{ site.baseurl }}{% post_url 2015-12-23-neon-node-rust %}). This means you can create JavaScript objects that internally wrap---and <a href="https://doc.rust-lang.org/book/ownership.html">own</a>---a Rust data structure, along with methods that can safely access the internal Rust data.</p><p>As a quick demonstration, suppose you have an <code>Employee</code> struct defined in Rust:</p><pre class="mdxCodeBlock_ziUc"><div class="codeBlockWrapper_3ZcX"><pre class="prism-code language-rust codeBlock_1wn8" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">pub</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">struct</span><span class="token plain"> Employee </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> i32</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> String</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// etc ...</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1PCb">Copy</button></div></pre><p>You can expose this to JS with the new <code>declare_types!</code> macro:</p><pre class="mdxCodeBlock_ziUc"><div class="codeBlockWrapper_3ZcX"><pre class="prism-code language-rust codeBlock_1wn8" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token macro-rules function" style="color:rgb(130, 170, 255)">declare_types!</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/// JS class wrapping Employee records.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">pub</span><span class="token plain"> class JsEmployee </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> Employee </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token function" style="color:rgb(130, 170, 255)">init</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">call</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token keyword" style="font-style:italic">let</span><span class="token plain"> scope </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> call</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">scope</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token keyword" style="font-style:italic">let</span><span class="token plain"> id </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">try!</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token function" style="color:rgb(130, 170, 255)">try!</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">call</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">arguments</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">require</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">scope</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">check</span><span class="token punctuation" style="color:rgb(199, 146, 234)">::</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">JsInteger</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token keyword" style="font-style:italic">let</span><span class="token plain"> name </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">try!</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token function" style="color:rgb(130, 170, 255)">try!</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">call</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">arguments</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">require</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">scope</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">to_string</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// etc ...</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token function" style="color:rgb(130, 170, 255)">Ok</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">Employee </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> i32</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// etc ...</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        method </span><span class="token function" style="color:rgb(130, 170, 255)">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">call</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token keyword" style="font-style:italic">let</span><span class="token plain"> scope </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> call</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">scope</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token keyword" style="font-style:italic">let</span><span class="token plain"> this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> Handle</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">JsEmployee</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> call</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">arguments</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">scope</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token keyword" style="font-style:italic">let</span><span class="token plain"> name </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">try!</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">vm</span><span class="token punctuation" style="color:rgb(199, 146, 234)">::</span><span class="token function" style="color:rgb(130, 170, 255)">lock</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token closure-params punctuation" style="color:rgb(199, 146, 234)">|</span><span class="token closure-params">employee</span><span class="token closure-params punctuation" style="color:rgb(199, 146, 234)">|</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                employee</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">clone</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token function" style="color:rgb(130, 170, 255)">Ok</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token function" style="color:rgb(130, 170, 255)">try!</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">JsString</span><span class="token punctuation" style="color:rgb(199, 146, 234)">::</span><span class="token function" style="color:rgb(130, 170, 255)">new_or_throw</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">scope</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">upcast</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1PCb">Copy</button></div></pre><p>This defines a custom JS class whose instances contain an <code>Employee</code> record. It binds <code>JsEmployee</code> to a Rust type that can create the class at runtime (i.e., the constructor function and prototype object). The <code>init</code> function defines the behavior for allocating the internals during construction of a new instance. The <code>name</code> method shows an example of how you can use <code>vm::lock</code> to borrow a reference to the internal Rust data of an instance.</p><p>From there, you can extract the constructor function and expose it to JS, for example by exporting it from a native module:</p><pre class="mdxCodeBlock_ziUc"><div class="codeBlockWrapper_3ZcX"><pre class="prism-code language-rust codeBlock_1wn8" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">register_module!</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">m</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">let</span><span class="token plain"> scope </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> m</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">scope</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">let</span><span class="token plain"> class </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">try!</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">JsEmployee</span><span class="token punctuation" style="color:rgb(199, 146, 234)">::</span><span class="token function" style="color:rgb(130, 170, 255)">class</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">scope</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">       </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// get the class</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">let</span><span class="token plain"> constructor </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">try!</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">class</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">constructor</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">scope</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// get the constructor</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">try!</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">m</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">exports</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">set</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Employee&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> constructor</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">     </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// export the constructor</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1PCb">Copy</button></div></pre><p>Then you can use instances of this type in JS just like any other object:</p><pre class="mdxCodeBlock_ziUc"><div class="codeBlockWrapper_3ZcX"><pre class="prism-code language-javascript codeBlock_1wn8" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> </span><span class="token maybe-class-name">Employee</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">require</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;./native&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> lumbergh </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Employee</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">9001</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Bill Lumbergh&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token console class-name" style="color:rgb(255, 203, 107)">console</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">log</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">lumbergh</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Bill Lumbergh</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1PCb">Copy</button></div></pre><p>Since the methods on <code>Employee</code> expect <code>this</code> to have the right binary layout, they check to make sure that they aren&#x27;t being called on an inappropriate object type. This means you can&#x27;t segfault Node by doing something like:</p><pre class="mdxCodeBlock_ziUc"><div class="codeBlockWrapper_3ZcX"><pre class="prism-code language-javascript codeBlock_1wn8" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token class-name" style="color:rgb(255, 203, 107)">Employee</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">prototype</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">call</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1PCb">Copy</button></div></pre><p>This safely throws a TypeError exception just like methods from other native classes like <code>Date</code> or <code>Buffer</code> do.</p><p>Anyway, that&#x27;s a little taste of user-defined native classes. More docs work to do!</p></article><div class="row margin-vert--lg"><div class="col"></div><div class="col text--right"><a href="/blog/2016/04/01/native-js-classes-in-neon"><strong>Read More</strong></a></div></div></div></div><div class="margin-bottom--xl"><div><header><h1 class="margin-bottom--sm blogPostTitle_3vXB"><a href="/blog/2015/12/23/neon-node-rust">Neon: Node + Rust = 💖</a></h1><div class="margin-bottom--sm"><small>December<!-- --> <!-- -->23<!-- -->, <!-- -->2015</small></div><div class="avatar margin-bottom--md"><div class="avatar__intro"><h4 class="avatar__name"><a target="_blank" rel="noreferrer noopener">Dave Herman</a></h4><small class="avatar__subtitle"></small></div></div></header><article class="markdown"><p>⚠️ This article contains references to an outdated version of neon ⚠️</p><p>If you&#x27;re a JavaScript programmer who&#x27;s been intrigued by Rust&#x27;s <a href="http://blog.rust-lang.org/2015/08/14/Next-year.html"><em>hack without fear</em></a> theme---making systems programming safe and fun---but you&#x27;ve been waiting for inspiration, I may have something for you! I&#x27;ve been working on <a href="https://github.com/dherman/neon">Neon</a>, a set of APIs and tools for <strong>making it super easy to write native Node modules in Rust</strong>.</p><p><strong>TL;DR:</strong></p><ul><li><a href="https://github.com/dherman/neon">Neon</a> is an API for writing fast, crash-free native Node modules in Rust;</li><li>Neon enables Rust&#x27;s parallelism with guaranteed thread safety;</li><li><a href="https://github.com/dherman/neon-cli">Neon-cli</a> makes it easy to create a Neon project and get started; and finally...</li><li>Help wanted!</li></ul><h2><a aria-hidden="true" class="anchor" id="i-can-rust-and-so-can-you"></a><a aria-hidden="true" class="hash-link" href="#i-can-rust-and-so-can-you">#</a>I Can Rust and So Can You!</h2><p>I wanted to make it as easy as possible to get up and running, so I built <a href="https://github.com/dherman/neon-cli">neon-cli</a>, a command-line tool that lets you generate a complete Neon project skeleton with one simple command and build your entire project with nothing more than the usual <code>npm install</code>.</p><p>If you want to try building your first native module with Neon, <strong>it&#x27;s super easy</strong>: install <a href="https://github.com/dherman/neon-cli">neon-cli</a> with <code>npm install -g neon-cli</code>, then create, build, and run your new project:</p><pre class="mdxCodeBlock_ziUc"><div class="codeBlockWrapper_3ZcX"><pre class="prism-code language-undefined codeBlock_1wn8" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">% neon new hello</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">...follow prompts...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">% cd hello</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">% npm install</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">% node -e &#x27;require(&quot;./&quot;)&#x27;</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1PCb">Copy</button></div></pre><p>If you don&#x27;t believe me, I made a <a href="https://raw.githubusercontent.com/dherman/neon-cli/master/screencast.gif">screencast</a>, so you <em>know</em> I&#x27;m legit.</p><h2><a aria-hidden="true" class="anchor" id="i-take-thee-at-thy-word"></a><a aria-hidden="true" class="hash-link" href="#i-take-thee-at-thy-word">#</a>I Take Thee at thy Word</h2><p>To illustrate what you can do with Neon, I created a little <a href="https://github.com/dherman/wc-demo">word counting demo</a>. The demo is simple: read in the complete plays of Shakespeare and count the total number of occurrences of the word &quot;thee&quot;. First I tried implementing it in pure JS. The top-level code splits the corpus into lines, and sums up the counts for each line:</p><pre class="mdxCodeBlock_ziUc"><div class="codeBlockWrapper_3ZcX"><pre class="prism-code language-javascript codeBlock_1wn8" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">search</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">corpus</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token parameter"> search</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">var</span><span class="token plain"> ls </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">lines</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">corpus</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">var</span><span class="token plain"> total </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">var</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> n </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> ls</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">length</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> n</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> i</span><span class="token operator" style="color:rgb(137, 221, 255)">++</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    total </span><span class="token operator" style="color:rgb(137, 221, 255)">+=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">wcLine</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">ls</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> search</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> total</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1PCb">Copy</button></div></pre><p>Searching an individual line involves splitting the line up into word and matching each word against the search string:</p><pre class="mdxCodeBlock_ziUc"><div class="codeBlockWrapper_3ZcX"><pre class="prism-code language-javascript codeBlock_1wn8" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">wcLine</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">line</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token parameter"> search</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">var</span><span class="token plain"> words </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> line</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">split</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27; &#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">var</span><span class="token plain"> total </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">var</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> n </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> words</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">length</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> n</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> i</span><span class="token operator" style="color:rgb(137, 221, 255)">++</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token function" style="color:rgb(130, 170, 255)">matches</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">words</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> search</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      total</span><span class="token operator" style="color:rgb(137, 221, 255)">++</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> total</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1PCb">Copy</button></div></pre><p>The rest of the details are pretty straightforward but definitely <a href="https://github.com/dherman/wc-demo/blob/master/lib/search.js">check out the code</a>---it&#x27;s small and self-contained.</p><p>On my laptop, running the algorithm across all the plays of Shakespeare usually takes about 280 -- 290ms. Not hugely expensive, but slow enough to be optimizable.</p><h2><a aria-hidden="true" class="anchor" id="fall-into-our-rustic-revelry"></a><a aria-hidden="true" class="hash-link" href="#fall-into-our-rustic-revelry">#</a>Fall Into our Rustic Revelry</h2><p>One of the amazing things about Rust is that highly efficient code can still be remarkably compact and readable. In the <a href="https://github.com/dherman/wc-demo/blob/master/src/lib.rs">Rust version of the algorithm</a>, the code for summing up the counts for all the lines looks pretty similar to the JS code:</p><pre class="mdxCodeBlock_ziUc"><div class="codeBlockWrapper_3ZcX"><pre class="prism-code language-rust codeBlock_1wn8" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">let</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">mut</span><span class="token plain"> total </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> word </span><span class="token keyword" style="font-style:italic">in</span><span class="token plain"> line</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">split</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token char string" style="color:rgb(195, 232, 141)">&#x27; &#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">matches</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">word</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> search</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        total </span><span class="token operator" style="color:rgb(137, 221, 255)">+=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">total </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// in Rust you can omit `return` for a trailing expression</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1PCb">Copy</button></div></pre><p>In fact, that same code can be written at a higher level of abstraction <em>without losing performance</em>, using iteration methods like <a href="http://doc.rust-lang.org/std/iter/trait.Iterator.html#method.filter"><code>filter</code></a> and <a href="http://doc.rust-lang.org/std/iter/trait.Iterator.html#method.fold"><code>fold</code></a> (similar to <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/filter"><code>Array.prototype.filter</code></a> and <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/Reduce"><code>Array.prototype.reduce</code></a> in JS):</p><pre class="mdxCodeBlock_ziUc"><div class="codeBlockWrapper_3ZcX"><pre class="prism-code language-rust codeBlock_1wn8" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">line</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">split</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token char string" style="color:rgb(195, 232, 141)">&#x27; &#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">filter</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain">word</span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">matches</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">word</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> search</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">fold</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain">sum</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> _</span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> sum </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1PCb">Copy</button></div></pre><p>In my quick experiments, that even seems to shave a few milliseconds off the total running time. I think this is a nice demonstration of the power of Rust&#x27;s <a href="http://blog.rust-lang.org/2015/05/11/traits.html">zero-cost abstractions</a>, where idiomatic and high-level abstractions produce the same or sometimes even better performance (by making additional optimizations possible, like eliminating bounds checks) than lower-level, more obscure code.</p><p>On my machine, the simple Rust translation runs in about 80 -- 85ms. Not bad---about 3x as fast just from using Rust, and in roughly the same number of lines of code (60 in JS, 70 in Rust). By the way, I&#x27;m being approximate here with the numbers, because this isn&#x27;t a remotely scientific benchmark. My goal is just to demonstrate that you <em>can</em> get significant performance improvements from using Rust; in any given situation, the particular details will of course matter.</p><h2><a aria-hidden="true" class="anchor" id="their-thread-of-life-is-spun"></a><a aria-hidden="true" class="hash-link" href="#their-thread-of-life-is-spun">#</a>Their Thread of Life is Spun</h2><p>We&#x27;re not done yet, though! Rust enables something even cooler for Node: we can easily and safely parallelize this code---and I mean <a href="http://blog.rust-lang.org/2015/04/10/Fearless-Concurrency.html">without the night-sweats and palpitations usually associated with multithreading</a>. Here&#x27;s a quick look at the top level logic in the Rust implementation of the demo:</p><pre class="mdxCodeBlock_ziUc"><div class="codeBlockWrapper_3ZcX"><pre class="prism-code language-rust codeBlock_1wn8" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">let</span><span class="token plain"> total </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> vm</span><span class="token punctuation" style="color:rgb(199, 146, 234)">::</span><span class="token function" style="color:rgb(130, 170, 255)">lock</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">buffer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token closure-params punctuation" style="color:rgb(199, 146, 234)">|</span><span class="token closure-params">data</span><span class="token closure-params punctuation" style="color:rgb(199, 146, 234)">|</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">let</span><span class="token plain"> corpus </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">as_str</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">unwrap</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">let</span><span class="token plain"> lines </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">lines</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">corpus</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    lines</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">into_iter</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">map</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain">line</span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">wc_line</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">line</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> search</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">fold</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain">sum</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> line</span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> sum </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> line</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1PCb">Copy</button></div></pre><p>The <code>vm::lock</code> API lets Neon safely expose the raw bytes of a Node <code>Buffer</code> object (i.e., a typed array) to Rust threads, by preventing JS from running in the meantime. And Rust&#x27;s concurrency model makes programming with threads <em>actually fun</em>.</p><p>To demonstrate how easy this can be, I used <a href="http://smallcultfollowing.com/babysteps/blog/2015/12/18/rayon-data-parallelism-in-rust/">Niko Matsakis&#x27;s new Rayon crate</a> of beautiful data parallelism abstractions. Changing the demo to use Rayon is as simple as replacing the <code>into_iter</code>/<code>map</code>/<code>fold</code>/ lines above with:</p><pre class="mdxCodeBlock_ziUc"><div class="codeBlockWrapper_3ZcX"><pre class="prism-code language-rust codeBlock_1wn8" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">lines</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">into_par_iter</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">map</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain">line</span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">wc_line</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">line</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> search</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">sum</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1PCb">Copy</button></div></pre><p>Keep in mind, Rayon wasn&#x27;t designed with Neon in mind---its generic primitives match the iteration protocols of Rust, so Neon was able to just pull it off the shelf.</p><p>With that simple change, on my two-core MacBook Air, the demo goes from about 85ms down to about 50ms.</p><h2><a aria-hidden="true" class="anchor" id="bridge-most-valiantly-with-excellent-discipline"></a><a aria-hidden="true" class="hash-link" href="#bridge-most-valiantly-with-excellent-discipline">#</a>Bridge Most Valiantly, with Excellent Discipline</h2><p>I&#x27;ve worked on making the integration as seamless as possible. From the Rust side, Neon functions follow a simple protocol, taking a <code>Call</code> object and returning a JavaScript value:</p><pre class="mdxCodeBlock_ziUc"><div class="codeBlockWrapper_3ZcX"><pre class="prism-code language-rust codeBlock_1wn8" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">fn</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">search</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">call</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> Call</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-&gt;</span><span class="token plain"> JS</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">Integer</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">let</span><span class="token plain"> scope </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> call</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">scope</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// ...</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">Ok</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">Integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">::</span><span class="token function" style="color:rgb(130, 170, 255)">new</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">scope</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> total</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1PCb">Copy</button></div></pre><p>The <code>scope</code> object safely tracks handles into V8&#x27;s garbage-collected heap. The Neon API uses the Rust type system to guarantee that your native module can&#x27;t crash your app by mismanaging object handles.</p><p>From the JS side, loading the native module is straightforward:</p><pre class="mdxCodeBlock_ziUc"><div class="codeBlockWrapper_3ZcX"><pre class="prism-code language-javascript codeBlock_1wn8" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">var</span><span class="token plain"> myNeonModule </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">require</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;neon-bridge&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">load</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1PCb">Copy</button></div></pre><h2><a aria-hidden="true" class="anchor" id="wherefores-this-noise"></a><a aria-hidden="true" class="hash-link" href="#wherefores-this-noise">#</a>Wherefore&#x27;s this Noise?</h2><p>I hope this demo is enough to get people interested. Beyond the sheer fun of it, I think the strongest reasons for using Rust in Node are performance and parallelism. As the Rust ecosystem grows, it&#x27;ll also be a way to give Node access to cool Rust libraries. Beyond that, I&#x27;m hoping that Neon can make a nice abstraction layer that just makes writing native Node modules less painful. With projects like <a href="https://blogs.windows.com/buildingapps/2015/05/12/bringing-node-js-to-windows-10-iot-core/">node-uwp</a> it might even be worth exploring evolving Neon towards a JS-engine-agnostic abstraction layer.</p><p>There are lots of possibilities, but <a href="https://github.com/dherman/neon">I need help!</a> If you want to get involved, I&#x27;ve created a <a href="http://rustbridge.slack.com">community slack</a> (grab an invite from <a href="http://rustbridge-community-slackin.herokuapp.com">the Slackin app</a>) and a <code>#neon</code> IRC channel on <a href="https://wiki.mozilla.org/IRC">Mozilla IRC</a> (<code>irc.mozilla.org</code>).</p><h2><a aria-hidden="true" class="anchor" id="a-quick-thanks"></a><a aria-hidden="true" class="hash-link" href="#a-quick-thanks">#</a>A Quick Thanks</h2><p>There&#x27;s a ton of fun exploration and work left to do but I couldn&#x27;t have gotten this far without huge amounts of help already: <a href="http://oppenlander.me/articles/rust-ffi">Andrew Oppenlander&#x27;s blog post</a> got me off the ground, Ben Noordhuis and Marcin Cieślak helped me wrestle with V8&#x27;s tooling, I picked up a few tricks from Nathan Rajlich&#x27;s <a href="https://github.com/TooTallNate/node-bindings/blob/master/bindings.js">evil genius code</a>, Adam Klein and Fedor Indutny helped me understand the V8 API, Alex Crichton helped me with compiler and linker arcana, Niko Matsakis helped me with designing the safe memory management API, and Yehuda Katz helped me with the overall design.</p><p>You know what this means? <a href="https://github.com/dherman/neon"><strong>Maybe you can help too!</strong></a></p></article><div class="row margin-vert--lg"><div class="col"></div><div class="col text--right"><a href="/blog/2015/12/23/neon-node-rust"><strong>Read More</strong></a></div></div></div></div><nav class="pagination-nav"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" label="Getting Started" href="/getting-started">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" label="Examples" url="https://github.com/neon-bindings/examples">Examples</a></li><li class="footer__item"><a class="footer__link-item" label="API Reference" to="https://neon-bindings.com/api/neon/index.html" href="https://neon-bindings.com/api/neon/index.html">API Reference</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" label="Community Chat" url="https://rust-bindings-slackin.herokuapp.com">Community Chat</a></li><li class="footer__item"><a class="footer__link-item" label="Twitter" to="https://twitter.com/rustneon" href="https://twitter.com/rustneon">Twitter</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" label="GitHub" to="https://github.com/neon-bindings/neon" href="https://github.com/neon-bindings/neon">GitHub</a></li></ul></div></div><div class="text--center"><div class="margin-bottom--sm"><img class="footer__logo" alt="Neon Logo" src="/logo/text-logo.svg"/></div>Copyright © 2019 Neon Bindings</div></div></footer>
</div>

<script type="text/javascript" src="/runtime~main.4065e0513f6e595f784e.js"></script>

<script type="text/javascript" src="/main.ce136d421303be087674.js"></script>

<script type="text/javascript" src="/0.4b32e68eb0c1f2ec7fdc.js"></script>

<script type="text/javascript" src="/1.03d30ec9a08dd178696f.js"></script>

<script type="text/javascript" src="/component---theme-blog-list-pagea-6-a-7ba.73e7f10320fd40850a08.js"></script>

<script type="text/javascript" src="/content---blogcee-0c9.35a29afc27cd16810de8.js"></script>

<script type="text/javascript" src="/metadata---blog-2018-10-22-hello-world-75-b-360.cf00bf416a5b3b17ba73.js"></script>

<script type="text/javascript" src="/content---blog-191-793.474fac1b2a9442c6f41d.js"></script>

<script type="text/javascript" src="/nextItem---blog-2018-10-22-hello-world-473-b89.d99cc84a55b8ebae18d6.js"></script>

<script type="text/javascript" src="/content---blogab-1-45e.3b4250fe9ebdc796d69f.js"></script>

<script type="text/javascript" src="/nextItem---blog-2018-01-14-rust-2018-a-neon-wish-listcea-8d0.e89b81c942fed6090d10.js"></script>

<script type="text/javascript" src="/content---blog-89-e-b53.f3496b554278894dbcb3.js"></script>

<script type="text/javascript" src="/nextItem---blog-2017-09-25-neon-wants-your-helpbc-0-72a.38139701f750bf113b09.js"></script>

<script type="text/javascript" src="/content---blogccb-196.9e553299d1626cc06c1f.js"></script>

<script type="text/javascript" src="/nextItem---blog-2016-04-01-native-js-classes-in-neon-81-a-35c.e8b0ad36e6019cc5a771.js"></script>

<script type="text/javascript" src="/metadata---blog-1-a-9-d63.696b05f19503cdb900a9.js"></script>

</body>
</html>